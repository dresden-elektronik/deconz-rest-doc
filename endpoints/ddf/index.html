<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Device Description Files (DDF) - deCONZ REST-API</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Device Description Files (DDF)";
        var mkdocs_page_input_path = "endpoints/ddf/index.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> deCONZ REST-API
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">General</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about_rest/">About REST</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting_started/">Getting Started</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Endpoints</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../alarmsystems/">Alarm Systems</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configuration/">Configuration</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Device Description Files (DDF)</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#ddf-bundles">DDF bundles</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#problems-with-plain-ddf-json-files">Problems with plain DDF JSON files</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#what-ddf-bundles-solve">What DDF bundles solve</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ddf-bundle-pinning">DDF bundle pinning</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#get-all-ddf-bundle-descriptors">Get all DDF bundle descriptors&nbsp;</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#parameters">Parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#response">Response</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#response-fields">Response fields</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#possible-errors">Possible errors</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#get-ddf-bundle-descriptor">Get DDF bundle descriptor&nbsp;</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#parameters_1">Parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#response_1">Response</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#response-fields_1">Response fields</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#possible-errors_1">Possible errors</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#upload-ddf-bundle">Upload DDF bundle&nbsp;</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#parameters_2">Parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#example-request-data">Example request data</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#response_2">Response</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#possible-errors_2">Possible errors</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../groups/">Groups</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lights/">Lights</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../rules/">Rules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenes/">Scenes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../schedules/">Schedules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sensors/">Sensors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sensors/button_events/">Button Events</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../touchlink/">Touchlink</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../websocket/">Websocket</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../devices/">Supported Devices</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Misc</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../misc/discovery/">Discovery</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../misc/authorization/">Authorization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../misc/errors/">Error handling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../misc/polling/">Polling</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">deCONZ REST-API</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>API Endpoints &raquo;</li>
      <li>Device Description Files (DDF)</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/dresden-elektronik/deconz-rest-doc/edit/master/docs/endpoints/ddf/index.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="device-description-files-ddf">Device Description Files (DDF)<a class="headerlink" href="#device-description-files-ddf" title="Permanent link">&para;</a></h1>
<p><mark>Work in progress</mark></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This page serves as a Request For Comments (RFC). This API is not yet available in a release.</p>
</div>
<p>The <strong>/ddf</strong> endpoint provides query and management calls for DDF bundles.</p>
<h3 id="ddf-bundles">DDF bundles<a class="headerlink" href="#ddf-bundles" title="Permanent link">&para;</a></h3>
<p>A DDF bundle is a single self contained <strong>immutable</strong> file which embeds the DDF JSON and all dependencies like scripts and other files, see: <a href="https://github.com/deconz-community/ddf-tools/blob/main/packages/bundler/README.md">specification</a>.</p>
<h4 id="problems-with-plain-ddf-json-files">Problems with plain DDF JSON files<a class="headerlink" href="#problems-with-plain-ddf-json-files" title="Permanent link">&para;</a></h4>
<p>While DDF system improved the C++ mess, it still has the same issues which can also be found in ZHA and Zigbee2Mqtt device integrations:</p>
<ul>
<li>Global updates bound to a deCONZ release.
  When a new release comes out, it&rsquo;s all or nothing every device gets the newest DDF JSON but also its dependencies like scripts, which may be used and changed for other devices, introducing unforseen bugs.</li>
<li>When something breaks, <strong>and this happens</strong>, perhaps since a script or DDF JSON was updated, there is no way back, other than downgrading of deCONZ.</li>
<li>Distributing new DDF files is cumbersome, and when external scripts are referenced even more so.</li>
<li>Users have to wait for new deCONZ releases for latest official DDFs updates.</li>
</ul>
<h4 id="what-ddf-bundles-solve">What DDF bundles solve<a class="headerlink" href="#what-ddf-bundles-solve" title="Permanent link">&para;</a></h4>
<ul>
<li>Easy exchange during development, just send the DDF bundle to a user.</li>
<li>Decoupling from deCONZ releases.</li>
<li>Support for multiple versions for a bundle, e.g. run a new beta version only on one test device.</li>
<li>Support switching between bundle versions for a device, e.g. if v1.0.1 doesn&rsquo;t work user can switch back to v1.0.0.</li>
<li>Bundles are immutable and signed, this drastically reduces the chance of breaking a device integration.</li>
<li>A bundle can&rsquo;t break another one, even if it&rsquo;s using the same external dependencies.</li>
</ul>
<p>From a users perspective there won&rsquo;t be all or nothing updates dependend on a deCONZ version. Instead DDF updates are explicit like this simplified UI:</p>
<blockquote>
<p>DDF update available for <em>&ldquo;Kitchen motion sensor&rdquo;</em> (model id: SML003).</br>
Currently installed version: <strong>v1.2.1</strong> </br>
Update to version <strong>v1.2.5</strong>? (yes/no/all)</p>
</blockquote>
<h2 id="ddf-bundle-pinning">DDF bundle pinning<a class="headerlink" href="#ddf-bundle-pinning" title="Permanent link">&para;</a></h2>
<div class="admonition todo">
<p class="admonition-title">Todo</p>
<p>Currently this page only describes how to query bundle information and upload bundles.
To actually assign/pin DDF bundles to a device <code>uniqueid</code>, the <code>/devices</code>
endpoint needs to be extended.</p>
</div>
<p>The following tasks need to be clarified:</p>
<ul>
<li><strong>Initial behaviour</strong> when a device is joined it should automatically be assigned to a suiteable bundle, with the newest version, ideally a bundle that is signed with a &ldquo;stable&rdquo; signature.</li>
<li><strong>Manual update</strong> Once a device is pinned to a bundle, updating to a new DDF bundle version needs to be done explicitly.
  Like <code>PUT /api/&lt;apikey&gt;/devices/&lt;uniqueid&gt;/usebundle/&lt;sha256&gt;</code>, where the bundle with SHA-256 hash itself was <a href="#uploadddfbundle">Uploaded</a> before.</li>
<li><strong>Auto updates</strong> could be made an option, like auto update stable signed bundles. Each deCONZ release does contain the latest official DDF bundles. In future these can also be updated by loading fresh ones from the DDF store which doesn&rsquo;t depend on a deCONZ release.</li>
</ul>
<hr />
<h2 id="get-all-ddf-bundle-descriptors">Get all DDF bundle descriptors<a name="getallddfbundledescriptors">&nbsp;</a><a class="headerlink" href="#get-all-ddf-bundle-descriptors" title="Permanent link">&para;</a></h2>
<pre><code>GET /api/&lt;apikey&gt;/ddf/descriptors
</code></pre>
<p>Returns the descriptors of all available DDF bundles.</p>
<h3 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h3>
<p>None</p>
<h3 id="response">Response<a class="headerlink" href="#response" title="Permanent link">&para;</a></h3>
<pre class="headers">
<code class="no-highlight">
HTTP/1.1 200 OK
</code>
</pre>
<pre class="highlight">
<code>
{

  "12f39fa2bc4db1990715318e749d6270139609c68fb651a70c59339a91207450": {
    "version": "1.2.5",
    "version_deconz": ">2.19.3",
    "last_modified": "2023-04-13T11:54:25Z",
    "product": "STARKVIND Air purifier",
    "device_identifiers": [
      [
        "IKEA of Sweden",
        "STARKVIND Air purifier"
      ],
      [
        "IKEA of Sweden",
        "STARKVIND Air purifier table"
      ]
    ]
  }
}
</code>
</pre>

<div class="admonition todo">
<p class="admonition-title">Todo</p>
<p>It might be useful to also return the bundle signatures, so a UI can show: offical, stable, beta and user labels.</p>
</div>
<h4 id="response-fields">Response fields<a class="headerlink" href="#response-fields" title="Permanent link">&para;</a></h4>
<p>The keys in the returned object are the SHA-256 hashes of the immutable data in the DDF bundles (hash over DDFB section).</p>
<p>See <a href="#getddfbundledescriptor">Get DDF bundle descriptor</a> for a full description of the attributes.</p>
<h3 id="possible-errors">Possible errors<a class="headerlink" href="#possible-errors" title="Permanent link">&para;</a></h3>
<p><a href="../../misc/errors#403">403 Forbidden</a></p>
<hr />
<h2 id="get-ddf-bundle-descriptor">Get DDF bundle descriptor<a name="getddfbundledescriptor">&nbsp;</a><a class="headerlink" href="#get-ddf-bundle-descriptor" title="Permanent link">&para;</a></h2>
<pre><code>GET /api/&lt;apikey&gt;/ddf/descriptors/&lt;sha256-hash&gt;
</code></pre>
<p>Returns the descriptor of a DDF bundle.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This request is useful to retreive the active DDF bundle descriptor of a
device which can be retreived with the <code>`/devices/&lt;uniqueid&gt;</code> endpoint (wip).
The idea here is to <strong>pin</strong> a bundle via it&rsquo;s sha256-hash to a device identified by its
MAC address.</p>
</div>
<h3 id="parameters_1">Parameters<a class="headerlink" href="#parameters_1" title="Permanent link">&para;</a></h3>
<p>None</p>
<h3 id="response_1">Response<a class="headerlink" href="#response_1" title="Permanent link">&para;</a></h3>
<pre class="headers">
<code class="no-highlight">
HTTP/1.1 200 OK
</code>
</pre>
<pre class="highlight">
<code>
{
    "version": "1.2.5",
    "version_deconz": ">2.19.3",
    "last_modified": "2023-04-13T11:54:25Z",
    "product": "STARKVIND Air purifier",
    "device_identifiers": [
      [
        "IKEA of Sweden",
        "STARKVIND Air purifier"
      ],
      [
        "IKEA of Sweden",
        "STARKVIND Air purifier table"
      ]
    ]
}
</code>
</pre>

<div class="admonition todo">
<p class="admonition-title">Todo</p>
<p>It might be useful to also return the bundle signatures, so a UI can show: offical, stable, beta and user labels.
Since the signatures are made over the SHA-256 hash it&rsquo;s easy to verify them without loading the full bundle.</p>
</div>
<h4 id="response-fields_1">Response fields<a class="headerlink" href="#response-fields_1" title="Permanent link">&para;</a></h4>
<table class="table table-bordered">
  <thead>
    <tr><th>Field</th><th>Type</th><th>Description</th><th></th></tr>
  </thead>
  <tbody>
    <tr>
      <td>version</td>
      <td>String</td>
      <td>The semantic version of a bundle.</td>
      <td>R</td>
    </tr>
    <tr>
      <td>version_deconz</td>
      <td>String</td>
      <td>deCONZ versions requirements to run the bundle.</td>
      <td>R</td>
    </tr>
    <tr>
      <td>last_modified</td>
      <td>ISO 8601 timestamp</td>
      <td>Timestamp when the bundle was last modified.</td>
      <td>R</td>
    </tr>
    <tr>
      <td>product</td>
      <td>String</td>
      <td>Human readable product name.</td>
      <td>R</td>
    </tr>
    <tr>
      <td>device_identifiers</td>
      <td>Array</td>
      <td>Pairs of Zigbee manufacturer name and model id</br>from the Basic cluster.</td>
      <td>R</td>
    </tr>
  </tbody>
</table>

<h3 id="possible-errors_1">Possible errors<a class="headerlink" href="#possible-errors_1" title="Permanent link">&para;</a></h3>
<p><a href="../../misc/errors#403">403 Forbidden</a></p>
<p><a href="../../misc/errors#404">404 Not Found</a></p>
<hr />
<h2 id="upload-ddf-bundle">Upload DDF bundle<a name="uploadddfbundle">&nbsp;</a><a class="headerlink" href="#upload-ddf-bundle" title="Permanent link">&para;</a></h2>
<pre><code>POST /api/&lt;apikey&gt;/ddf/bundles
</code></pre>
<p>Uploads a DDF bundle so it can be used by DDF system.</p>
<h3 id="parameters_2">Parameters<a class="headerlink" href="#parameters_2" title="Permanent link">&para;</a></h3>
<p>The DDF bundle is uploaded as <code>multipart/form-data</code>, which is used by HTML form input elements with <code>type="file"</code> (see: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition">MSDN</a>).</p>
<h3 id="example-request-data">Example request data<a class="headerlink" href="#example-request-data" title="Permanent link">&para;</a></h3>
<pre><code class="language-raw">POST /api/12345/ddf/bundles HTTP/1.1

Content-Type: multipart/form-data;boundary=&quot;abcdef&quot;

--abcdef
Content-Disposition: form-data; name=&quot;ddfbundle&quot;; filename=&quot;example.ddf&quot;

    ....... DDF bundle data .....
--abcdef--
</code></pre>
<h3 id="response_2">Response<a class="headerlink" href="#response_2" title="Permanent link">&para;</a></h3>
<pre class="headers">
<code class="no-highlight">
HTTP/1.1 200 OK
</code>
</pre>
<pre class="highlight">
<code>
[ { "success": { "id": "12f39fa2bc4db1990715318e749d6270139609c68fb651a70c59339a91207450" } } ]
</code>
</pre>

<p>The returned <strong>id</strong> is the DDF bundle SHA-256 hash.</p>
<h3 id="possible-errors_2">Possible errors<a class="headerlink" href="#possible-errors_2" title="Permanent link">&para;</a></h3>
<p><a href="../../misc/errors#400">400 Bad Request</a></p>
<p><a href="../../misc/errors#403">403 Forbidden</a></p>
<hr />
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../configuration/" class="btn btn-neutral float-left" title="Configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../groups/" class="btn btn-neutral float-right" title="Groups">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/dresden-elektronik/deconz-rest-doc" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../configuration/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../groups/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
